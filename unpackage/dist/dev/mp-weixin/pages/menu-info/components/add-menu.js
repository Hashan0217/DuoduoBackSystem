(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/menu-info/components/add-menu"],{0:function(e,t,n){"use strict";(function(e,r){var o=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=o(n(11));n(26);var a=o(n(27)),u=o(n(25));n(33);var s=o(n(34)),c=o(n(159)),l=o(n(174));function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function d(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach((function(t){(0,i.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}e.__webpack_require_UNI_MP_PLUGIN__=n,u.default.use(s.default);var m=new l.default;u.default.prototype.$socket=m,u.default.config.productionTip=!1,a.default.mpType="app";var p=new u.default(d({store:c.default},a.default));r(p).$mount();var h=p;t.default=h}).call(this,n(1)["default"],n(2)["createApp"])},239:function(e,t,n){"use strict";n.r(t);var r=n(240),o=n(242);for(var i in o)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(i);n(245);var a,u=n(32),s=Object(u["default"])(o["default"],r["render"],r["staticRenderFns"],!1,null,null,null,!1,r["components"],a);s.options.__file="pages/menu-info/components/add-menu.vue",t["default"]=s.exports},240:function(e,t,n){"use strict";n.r(t);var r=n(241);n.d(t,"render",(function(){return r["render"]})),n.d(t,"staticRenderFns",(function(){return r["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return r["recyclableRender"]})),n.d(t,"components",(function(){return r["components"]}))},241:function(e,t,n){"use strict";var r;n.r(t),n.d(t,"render",(function(){return o})),n.d(t,"staticRenderFns",(function(){return a})),n.d(t,"recyclableRender",(function(){return i})),n.d(t,"components",(function(){return r}));try{r={uForm:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-form/u-form")]).then(n.bind(null,334))},uFormItem:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-form-item/u-form-item")]).then(n.bind(null,343))},uInput:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-input/u-input")]).then(n.bind(null,351))},uGap:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-gap/u-gap")]).then(n.bind(null,359))},uNumberBox:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-number-box/u-number-box")]).then(n.bind(null,367))},uUpload:function(){return Promise.all([n.e("common/vendor"),n.e("uni_modules/uview-ui/components/u-upload/u-upload")]).then(n.bind(null,375))}}}catch(u){if(-1===u.message.indexOf("Cannot find module")||-1===u.message.indexOf(".vue"))throw u;console.error(u.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var e=this,t=e.$createElement;e._self._c},i=!1,a=[];o._withStripped=!0},242:function(e,t,n){"use strict";n.r(t);var r=n(243),o=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);t["default"]=o.a},243:function(e,t,n){"use strict";(function(e){var r=n(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=r(n(56)),i=r(n(58)),a=r(n(11)),u=n(168),s=n(160),c=r(n(244));function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){(0,a.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var d={data:function(){return{form:{name:"",price:"",unit:"",shopStocks:"",catgoryIndex:0,catgoryId:0},action:"http://localhost:8001/api/file/upload",showUploadList:!1,uUpload:{},fileList:[],fileResName:"",filiePreviewUrl:"",reviseItemOldCatgoryId:"",Revise:!1}},onLoad:function(e){e&&(this.Revise=!0,this.handleRevise(e))},created:function(){this.getCatgoryData()},computed:f({},(0,s.mapState)("menu_store",["categoryNameList","category","shopingItem"])),methods:{handleRevise:function(e){this.itemId=e.shopId;var t,n,r=e.catgoryId,o=this.shopingItem[r];o.data.forEach((function(n){if(n.dishId===e.shopId)return t=n,1})),this.category.forEach((function(e,t){if(e.id==r)return n=t,1})),this.form.name=t.name,this.form.price=t.price,this.form.unit=t.description,this.form.shopStocks=999,this.form.catgoryIndex=n,this.form.catgoryId=this.category[n].id,this.reviseItemOldCatgoryId=this.category[n].id},handleChange:function(e){this.form.catgoryIndex=e.target.value,this.form.catgoryId=this.category[e.target.value].id},getCatgoryData:function(){var e=this;return(0,i.default)(o.default.mark((function t(){var n;return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.$store.state.menu_store.category.length,0!=n){t.next=4;break}return t.next=4,(0,c.default)("menu_store/actionsGetShopingCategoryAll",1,"页面加载失败");case 4:case"end":return t.stop()}}),t)})))()},onReady:function(){this.uUpload=this.$refs.uUpload},valChange:function(e){console.log("当前值为: "+e.value)},afterRead:function(e){var t=this;return(0,i.default)(o.default.mark((function n(){var r,i,a,u,s;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:r=[].concat(e.file),i=t["fileList".concat(e.name)].length,r.map((function(n){t["fileList".concat(e.name)].push(f(f({},n),{},{status:"uploading",message:"上传中"}))})),a=0;case 4:if(!(a<r.length)){n.next=15;break}return n.next=7,t.uploadFilePromise(r[a].url);case 7:u=n.sent,t.fileResName=u.message,s=t["fileList".concat(e.name)][i],t["fileList".concat(e.name)].splice(i,1,Object.assign(s,{status:"success",message:"",url:u.data})),i++;case 12:a++,n.next=4;break;case 15:case"end":return n.stop()}}),n)})))()},uploadFilePromise:function(t){var n=this;return new Promise((function(r,o){e.uploadFile({url:"http://localhost:8001/api/file/upload",filePath:t,name:"file",formData:{file:n.fileList},success:function(e){r(JSON.parse(e.data))},fail:function(e){o(e)}})}))},getFiliesPreviewUrl:function(){var t=this;return(0,i.default)(o.default.mark((function n(){var r,i;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.fileResName){n.next=3;break}return e.showToast({title:"请上传图片",duration:2e3,icon:"error"}),n.abrupt("return");case 3:return n.next=5,(0,u.filiesPreview)(t.fileResName);case 5:if(r=n.sent,console.log(r,666),i=r.data,200!=i.code){n.next=13;break}return t.filiePreviewUrl=i.message,n.abrupt("return",!0);case 13:return e.showToast({title:"图片上传失败",duration:2e3,icon:"error"}),n.abrupt("return",!1);case 15:case"end":return n.stop()}}),n)})))()},deletePic:function(t){var n=this;return(0,i.default)(o.default.mark((function r(){var i;return o.default.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,(0,u.deletePreview)(n.fileResName);case 2:i=r.sent,200==i.data.code?n["fileList".concat(t.name)].splice(t.index,1):e.showToast({title:"删除失败",duration:2e3,icon:"error",mask:!0});case 4:case"end":return r.stop()}}),r)})))()},fromRulesFun:function(){var t=/(^[1-9]\d*(\.\d{1,2})?$)|(^0(\.\d{1,2})?$)/,n=t.test(this.form.price),r=this.form.name.length>0,o=this.form.unit.length>0,i=this.form.shopStocks>1;return n?!!(n&&r&&o&&i)||(e.showToast({title:"输入错误，正确输入",duration:2e3,icon:"error"}),!1):(e.showToast({title:"输入正确的价格",duration:2e3,icon:"error"}),this.form.price="",!1)},submit:function(){var t=this;return(0,i.default)(o.default.mark((function n(){var r,i,a,u,s,l,f,d;return o.default.wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.Revise){n.next=14;break}return i={id:t.itemId,name:t.form.name,description:t.form.unit,categoryId:t.form.catgoryId,price:t.form.price,image:t.fileResName,oldCatgoryId:t.reviseItemOldCatgoryId,flavors:[{name:"",value:""}]},a=t.fromRulesFun(),n.next=5,t.getFiliesPreviewUrl();case 5:if(r=n.sent,0==t.fileList.length&&(r=!0,delete i.image),!a||!r){n.next=12;break}return n.next=10,(0,c.default)("menu_store/actionsgetReviseShopingItem",i,"修改失败");case 10:u=n.sent,u&&(e.showToast({title:"修改成功",duration:2e3,icon:"success"}),t.emptyForm());case 12:n.next=25;break;case 14:return s=t.fromRulesFun(),n.next=17,t.getFiliesPreviewUrl();case 17:if(l=n.sent,console.log(l),!s||!l){n.next=25;break}return f={name:t.form.name,description:t.form.unit,categoryId:t.category[t.form.catgoryIndex].id,price:t.form.price,image:t.fileResName,flavors:[{name:"",value:""}]},n.next=23,(0,c.default)("menu_store/actionsAddShopingItem",f,"添加失败");case 23:d=n.sent,d&&(e.showToast({title:"添加成功",duration:2e3,icon:"success"}),t.emptyForm());case 25:case"end":return n.stop()}}),n)})))()},emptyForm:function(){this.form.name="",this.form.price="",this.form.unit="",this.form.shopStocks="",this.form.catgory=0,this.fileList=[]}}};t.default=d}).call(this,n(2)["default"])},245:function(e,t,n){"use strict";n.r(t);var r=n(246),o=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);t["default"]=o.a},246:function(e,t,n){},265:function(e,t,n){"use strict";(function(e,t){var r=n(4);n(26);r(n(25));var o=r(n(239));e.__webpack_require_UNI_MP_PLUGIN__=n,t(o.default)}).call(this,n(1)["default"],n(2)["createPage"])},27:function(e,t,n){"use strict";n.r(t);var r=n(28);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);n(30);var i,a,u,s,c=n(32),l=Object(c["default"])(r["default"],i,a,!1,null,null,null,!1,u,s);l.options.__file="App.vue",t["default"]=l.exports},28:function(e,t,n){"use strict";n.r(t);var r=n(29),o=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);t["default"]=o.a},29:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r={onLaunch:function(){console.log("App Launch")},onShow:function(){console.log("App Show")},onHide:function(){console.log("App Hide"),this.$socket.closeSocket()}};t.default=r},30:function(e,t,n){"use strict";n.r(t);var r=n(31),o=n.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);t["default"]=o.a},31:function(e,t,n){}},[[265,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../../.sourcemap/mp-weixin/pages/menu-info/components/add-menu.js.map